var ct=Object.create;var Pe=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var pt=Object.getPrototypeOf,ut=Object.prototype.hasOwnProperty;var Oe=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var _e=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var ft=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of dt(r))!ut.call(e,s)&&s!==t&&Pe(e,s,{get:()=>r[s],enumerable:!(n=lt(r,s))||n.enumerable});return e};var Ce=(e,r,t)=>(t=e!=null?ct(pt(e)):{},ft(r||!e||!e.__esModule?Pe(t,"default",{value:e,enumerable:!0}):t,e));var Ke=_e((he,je)=>{"use strict";var Tt=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},pe=Tt();je.exports=he=pe.fetch;pe.fetch&&(he.default=pe.fetch.bind(pe));he.Headers=pe.Headers;he.Request=pe.Request;he.Response=pe.Response});var Ne=_e((sr,Fe)=>{Ct()?Ee=window.fetch:Ee=Ke();var Ee;function Ct(){try{return window.fetch,!0}catch{return!1}}var Et={delay(e){return new Promise(r=>setTimeout(r,e))},tools:{exponentialBackoff(e){return Math.pow(2,e-1)*1e3}},defaults:{retryDelay(e,r){return r.details.response.status===429?Math.pow(2,e-1)*1e3:1e3},retryOn(e,r){return!!(r.details&&r.details.response&&(r.details.response.status>=500||r.details.response.status===429))}},async wrapper(e,r={},t={}){try{let s=await Ee(e,r),l=await s.text(),i=null;if(n(l)&&(i=JSON.parse(l)),s&&s.ok)return{url:e,options:r,response:s,helperData:t,json:i,text:l};let y=new Error(`Successful http request but response.ok === false. Code: ${s.status}, Text: ${l}`);throw y.details={url:e,options:r,response:s,helperData:t,json:i,text:l},y}catch(s){throw s.details?s.datails:s.details={url:e,options:r,helperData:t},s}function n(s){try{return JSON.parse(s),!0}catch{return!1}}},async one(e={url,options,helperData,retries,retryDelay,retryOn}){if(typeof e!="object"||!e.url)throw new Error("Invalid argument when calling _fetch.one. You must call _fetch.one with an object (settings), containing at-minimum: settings = {url: string}");e.options||(e.options={method:"GET"}),e.options&&!e.options.method&&(e.options.method="GET"),!e.retries&&e.retries!==0&&(e.retries=5),typeof e.retryDelay!="function"&&typeof e.retryDelay!="number"&&(e.retryDelay=this.defaults.retryDelay),typeof e.retryOn!="function"&&(e.retryOn=this.defaults.retryOn);let r;for(let t=0;t<=e.retries;t++)try{if(t>0){let n;typeof e.retryDelay=="function"?n=e.retryDelay(t,r):n=e.retryDelay,await this.delay(n)}return await this.wrapper(e.url,e.options,e.helperData)}catch(n){if(t===e.retries||!await e.retryOn(t,n))throw n;r=n,console.log(`failed fetch ${e.options.method} to ${e.url}. Code: ${n.details&&n.details.response?n.details.response.status:""}. Attempt ${t}. Retrying...`)}},async many(e={requests,delayMs,progressCbs}){e.delayMs||(e.delayMs=125);let r=[];e.requests.forEach((s,l)=>{let i=(async()=>{await this.delay(l*e.delayMs);let y=await this.one({url:s.url,options:s.options,retries:s.retries,retryDelay:s.retryDelay,retryOn:s.retryOn,helperData:{request:s,delayMs:l*e.delayMs,i:l}});return n++,e.progressCbs&&e.progressCbs.length&&e.progressCbs.forEach(_=>{_(n,t,y)}),y})();r.push(i)});let t=r.length,n=0;return Promise.allSettled(r)}};typeof Oe<"u"&&(Fe.exports=Et)});var Se=_e((cr,Le)=>{var ue=Ne();function St(e){r(),e.auth==="view-based"?this.headers={"X-Knack-Application-ID":e.applicationId,"X-Knack-REST-API-Key":"knack",Authorization:typeof e.userToken=="string"?e.userToken:"","Content-Type":"application/json"}:e.auth==="object-based"&&(this.headers={"X-Knack-Application-ID":e.applicationId,"X-Knack-REST-API-Key":e.apiKey,"Content-Type":"application/json"}),this.urlBase="https://api.knack.com/v1",this.remoteLogin=async function(t={email,password}){return await ue.one({url:`${this.urlBase}/applications/${this.headers["X-Knack-Application-ID"]}/session`,options:{method:"POST",body:JSON.stringify({email:t.email,password:t.password}),headers:{"Content-Type":"application/json"}}})},this.login=async function(t={email,password}){if(t.email&&t.password){let s=(await this.remoteLogin(t)).json.session.user.token;return this.headers.Authorization=s,s}else throw new Error("You did not specify one/both of email and password in settings object. Could not log in")},this.validateSession=async function(t={userToken,userRoleCheck}){if(typeof t.userToken!="string")throw new Error("You must provide a settings object with at least a userToken (string) to validateSession()");try{let s=(await ue.one({url:`${this.urlBase}/session/token`,options:{method:"GET",headers:{Authorization:t.userToken,"x-knack-application-id":this.headers["X-Knack-Application-ID"]}}})).json?.session;if(!s)throw new Error("No session found");if(s.user.status!=="current")throw new Error("Valid user but session not current.");if(s.user.account_status!=="active")throw new Error("Valid user but status not active.");if(s.user.approval_status!=="approved")throw new Error("Valid user but approval status is not approved.");if(t.userRoleCheck&&!s.user.profile_keys.includes(t.userRoleCheck))throw new Error("Valid user but does not include the specified user role.");return!0}catch{return!1}},this.url=function(t={scene,view,object,recordId}){let n=this.urlBase;return e.auth==="view-based"?n+=`/pages/${t.scene}/views/${t.view}/records/`:e.auth==="object-based"&&(n+=`/objects/${t.object}/records/`),t.recordId&&(n+=t.recordId),n},this.getRetries=function(t){return typeof t=="number"?t:5},this.setup=function(t,n){let s="";e.auth==="view-based"?s=this.url({scene:n.scene,view:n.view,recordId:n.recordId}):e.auth==="object-based"&&(s=this.url({object:n.object,recordId:n.recordId}));let l={method:t,headers:this.headers};n.body&&(l.body=JSON.stringify(n.body));let i=this.getRetries(n.retries);return{url:s,options:l,retries:i,helperData:n.helperData}},this.single=async function(t,n){let s=this.setup(t,n);return await ue.one(s)},this.many=async function(t,n){if(t==="GET")return console.log("knackAPI.many is only for POST, PUT and DELETE");let s=[];n.records.forEach(y=>{let _={view:n.view,scene:n.scene,object:n.object,retries:n.retries};t!=="DELETE"&&(_.body=y),t!=="POST"&&(_.recordId=y.id),s.push(this.setup(t,_))}),n.resultsReport&&this.tools.manyResultsReport.remove(n.resultsReport);let l=this.progressCbsSetup(n),i=await ue.many({requests:s,delayMs:125,progressCbs:l});return i.settings=n,i.summary=this.tools.manyResultsReport.calc(i),n.resultsReport&&this.tools.manyResultsReport.create(n.resultsReport,i),i},this.progressCbsSetup=function(t){let n=[];return t.progressBar&&(this.tools.progressBar.create(t.progressBar),n.push((s,l,i)=>{this.tools.progressBar.update(t.progressBar.id,s,l)})),t.progressCbs&&t.progressCbs.length&&t.progressCbs.forEach(s=>n.push(s)),n},this.get=async function(t={view,scene,object,recordId,helperData}){return await this.single("GET",t)},this.post=async function(t={view,scene,object,body,helperData,retries}){return await this.single("POST",t)},this.put=async function(t={recordId,view,scene,object,body,helperData,retries}){return await this.single("PUT",t)},this.delete=async function(t={recordId,view,scene,object,helperData,retries}){return await this.single("DELETE",t)},this.getMany=async function(t={view,scene,object,filters,rowsPerpage,startAtPage,maxRecordsToGet,helperData},n=1,s={records:[],pages:[]}){let l=this.setup("GET",t);n===1&&t.startAtPage>1&&(n=t.startAtPage);let i=t.maxRecordsToGet>0?t.maxRecordsToGet:1/0,y=t.rowsPerPage?t.rowsPerPage:1e3;l.url+=`?page=${n}&rows_per_page=${y}`,t.format&&(l.url+=`&format=${t.format}`),t.filters&&(l.url+=`&filters=${JSON.stringify(t.filters)}`);let _=await ue.one(l);return s.pages.push(_),_.json.records.map(M=>s.records.push(M)),s.helperData=t.helperData,s.records.length>i&&(s.records=s.records.splice(0,i)),s.records.length<i&&_.json.current_page<_.json.total_pages?await this.getMany(t,_.json.current_page+1,s):s},this.putMany=async function(t={records,view,scene,object,helperData,retries,progressBar,progressCbs,resultsReport}){return await this.many("PUT",t)},this.postMany=async function(t={records,view,scene,object,helperData,retries,progressBar,progressCbs,resultsReport}){return await this.many("POST",t)},this.deleteMany=async function(t={records,view,scene,object,helperData,retries,progressBar,progressCbs,resultsReport}){return await this.many("DELETE",t)},this.getFromReportView=async function(t={view,scene,sceneRecordId,helperData,retries}){if(e.auth!=="view-based")throw new Error("getFromReportView() only works when using view-based auth");if(!t.view||!t.scene)throw new Error("getFromReportView() requires a view and scene. You did not specify one or both.");if(t.recordId)throw new Error(`getFromReportView() does not support recordId. Specify settings.sceneRecordId if you are trying to load a report on a child page that has the data source of "this page's record" or similar.`);let n=`${this.urlBase}/scenes/${t.scene}/views/${t.view}/report`;if(t.sceneRecordId){let l=await this.getSceneSlug(t.scene);n+=`?${l}_id=${t.sceneRecordId}`}let s={url:n,options:{method:"GET",headers:this.headers},retries:this.getRetries(t.retries),helperData:t.helperData};return await ue.one(s)},this.tools={progressBar:{html(t){return $(`
                    <div id="${t}" style="margin-bottom: 10px;">
                        <span class="before-progress-bar" style="margin-right: 5px;"><em><strong>Processing records</em></strong></span>
                        <progress id="progressBar" value="0" max="100"></progress>
                        <span class="after-progress-bar" style="margin-left: 5px;" id="progressText">Initialising...</span>
                    </div>
                `)},update(t,n,s){$(`#${t} #progressBar`).val(Math.round(n/s*100)),$(`#${t} #progressText`).text(`${n}/${s}`)},create(t){$(`#${t.id}`).remove(),t.insertAfter?this.html(t.id).insertAfter(t.insertAfter):t.insertBefore?this.html(t.id).insertBefore(t.insertBefore):t.appendTo?this.html(t.id).appendTo(t.appendTo):t.prependTo?this.html(t.id).prependTo(t.prependTo):console.log("Invalid progress bar location")}},manyResultsReport:{calc(t){let n=t.reduce((i,y)=>(y.status==="fulfilled"&&i++,i),0),s=t.reduce((i,y)=>(y.status==="rejected"&&i++,i),0),l=t.filter(i=>i.status!=="fulfilled");return{fulfilled:n,rejected:s,errors:l}},html(t,n){let s=this.calc(n);return $(`
                    <div id=${t}>
                        <p><strong>Finished processing</strong></p>
                        <p>Summary:</p>
                        <p>
                            <ul>
                                <li>Failed: ${s.rejected}</li>
                                <li>Succeeded: ${s.fulfilled}</li>
                            </ul>
                        </p>
                    </div>
                `)},create(t,n){t.insertAfter?this.html(t.id,n).insertAfter(t.insertAfter):t.insertBefore?this.html(t.id,n).insertBefore(t.insertBefore):t.appendTo?this.html(t.id,n).appendTo(t.appendTo):t.prependTo?this.html(t.id,n).prependTo(t.prependTo):console.log("Invalid summary location")},remove(t){$(`#${t.id}`).remove()}}},this.getSceneSlug=async function(t){let n=`${this.urlBase}/applications/${this.headers["X-Knack-Application-ID"]}`,i=(await ue.one({url:n,options:{method:"GET"}})).json.application.scenes.find(_=>_.key===t);if(!i)throw new Error(`Scene with key ${t} not found, when trying to find corresponding slug (url). Could not continue.`);let y=i.slug;if(!y)throw new Error(`Scene with key ${t} found, but no slug (url) found. Could not continue.`);return y};function r(){if(!e)throw new Error("KnackAPI config settings object not found");if(!e.auth)throw new Error("KnackAPI.auth configuration not found");if(e.auth!=="object-based"&&e.auth!=="view-based")throw new Error(`KnackAPI.auth invalid - should be "view-based" or "object-based" but got "${e.auth}"`);if(!e.applicationId)throw new Error("KnackAPI.applicationId not found");if(e.auth==="object-based"&&!e.apiKey)throw new Error("Object-based auth selected but did not find an API key");try{e.auth==="object-based"&&Knack&&console.log(`
                    Warning! Object-based auth selected but it looks like you are running code in the Knack Javascript area. 
                    We strongly recommend you use view-based auth instead;
                `)}catch{}}}Le.exports=St});var et=_e((Ae,Ie)=>{(function(e,r){typeof define=="function"&&define.amd?define([],r):typeof Ie=="object"&&typeof Ae<"u"?Ie.exports=r():e.Papa=r()})(Ae,function e(){"use strict";var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},t=!r.document&&!!r.postMessage,n=r.IS_PAPA_WORKER||!1,s={},l=0,i={parse:function(a,o){var c=(o=o||{}).dynamicTyping||!1;if(b(c)&&(o.dynamicTypingFunction=c,c={}),o.dynamicTyping=c,o.transform=!!b(o.transform)&&o.transform,o.worker&&i.WORKERS_SUPPORTED){var d=function(){if(!i.WORKERS_SUPPORTED)return!1;var m=(N=r.URL||r.webkitURL||null,I=e.toString(),i.BLOB_URL||(i.BLOB_URL=N.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",I,")();"],{type:"text/javascript"})))),w=new r.Worker(m),N,I;return w.onmessage=ke,w.id=l++,s[w.id]=w}();return d.userStep=o.step,d.userChunk=o.chunk,d.userComplete=o.complete,d.userError=o.error,o.step=b(o.step),o.chunk=b(o.chunk),o.complete=b(o.complete),o.error=b(o.error),delete o.worker,void d.postMessage({input:a,config:o,workerId:d.id})}var u=null;return i.NODE_STREAM_INPUT,typeof a=="string"?(a=function(m){return m.charCodeAt(0)===65279?m.slice(1):m}(a),u=o.download?new M(o):new B(o)):a.readable===!0&&b(a.read)&&b(a.on)?u=new G(o):(r.File&&a instanceof File||a instanceof Object)&&(u=new Q(o)),u.stream(a)},unparse:function(a,o){var c=!1,d=!0,u=",",m=`\r
`,w='"',N=w+w,I=!1,f=null,D=!1;(function(){if(typeof o=="object"){if(typeof o.delimiter!="string"||i.BAD_DELIMITERS.filter(function(p){return o.delimiter.indexOf(p)!==-1}).length||(u=o.delimiter),(typeof o.quotes=="boolean"||typeof o.quotes=="function"||Array.isArray(o.quotes))&&(c=o.quotes),typeof o.skipEmptyLines!="boolean"&&typeof o.skipEmptyLines!="string"||(I=o.skipEmptyLines),typeof o.newline=="string"&&(m=o.newline),typeof o.quoteChar=="string"&&(w=o.quoteChar),typeof o.header=="boolean"&&(d=o.header),Array.isArray(o.columns)){if(o.columns.length===0)throw new Error("Option columns is empty");f=o.columns}o.escapeChar!==void 0&&(N=o.escapeChar+w),(typeof o.escapeFormulae=="boolean"||o.escapeFormulae instanceof RegExp)&&(D=o.escapeFormulae instanceof RegExp?o.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var g=new RegExp(ee(w),"g");if(typeof a=="string"&&(a=JSON.parse(a)),Array.isArray(a)){if(!a.length||Array.isArray(a[0]))return W(null,a,I);if(typeof a[0]=="object")return W(f||Object.keys(a[0]),a,I)}else if(typeof a=="object")return typeof a.data=="string"&&(a.data=JSON.parse(a.data)),Array.isArray(a.data)&&(a.fields||(a.fields=a.meta&&a.meta.fields||f),a.fields||(a.fields=Array.isArray(a.data[0])?a.fields:typeof a.data[0]=="object"?Object.keys(a.data[0]):[]),Array.isArray(a.data[0])||typeof a.data[0]=="object"||(a.data=[a.data])),W(a.fields||[],a.data||[],I);throw new Error("Unable to serialize unrecognized input");function W(p,E,J){var R="";typeof p=="string"&&(p=JSON.parse(p)),typeof E=="string"&&(E=JSON.parse(E));var L=Array.isArray(p)&&0<p.length,K=!Array.isArray(E[0]);if(L&&d){for(var F=0;F<p.length;F++)0<F&&(R+=u),R+=U(p[F],F);0<E.length&&(R+=m)}for(var h=0;h<E.length;h++){var k=L?p.length:E[h].length,S=!1,j=L?Object.keys(E[h]).length===0:E[h].length===0;if(J&&!L&&(S=J==="greedy"?E[h].join("").trim()==="":E[h].length===1&&E[h][0].length===0),J==="greedy"&&L){for(var T=[],H=0;H<k;H++){var x=K?p[H]:H;T.push(E[h][x])}S=T.join("").trim()===""}if(!S){for(var C=0;C<k;C++){0<C&&!j&&(R+=u);var X=L&&K?p[C]:C;R+=U(E[h][X],C)}h<E.length-1&&(!J||0<k&&!j)&&(R+=m)}}return R}function U(p,E){if(p==null)return"";if(p.constructor===Date)return JSON.stringify(p).slice(1,25);var J=!1;D&&typeof p=="string"&&D.test(p)&&(p="'"+p,J=!0);var R=p.toString().replace(g,N);return(J=J||c===!0||typeof c=="function"&&c(p,E)||Array.isArray(c)&&c[E]||function(L,K){for(var F=0;F<K.length;F++)if(-1<L.indexOf(K[F]))return!0;return!1}(R,i.BAD_DELIMITERS)||-1<R.indexOf(u)||R.charAt(0)===" "||R.charAt(R.length-1)===" ")?w+R+w:R}}};if(i.RECORD_SEP="",i.UNIT_SEP="",i.BYTE_ORDER_MARK="\uFEFF",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!t&&!!r.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=ye,i.ParserHandle=Z,i.NetworkStreamer=M,i.FileStreamer=Q,i.StringStreamer=B,i.ReadableStreamStreamer=G,r.jQuery){var y=r.jQuery;y.fn.parse=function(a){var o=a.config||{},c=[];return this.each(function(m){if(!(y(this).prop("tagName").toUpperCase()==="INPUT"&&y(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var w=0;w<this.files.length;w++)c.push({file:this.files[w],inputElem:this,instanceConfig:y.extend({},o)})}),d(),this;function d(){if(c.length!==0){var m,w,N,I,f=c[0];if(b(a.before)){var D=a.before(f.file,f.inputElem);if(typeof D=="object"){if(D.action==="abort")return m="AbortError",w=f.file,N=f.inputElem,I=D.reason,void(b(a.error)&&a.error({name:m},w,N,I));if(D.action==="skip")return void u();typeof D.config=="object"&&(f.instanceConfig=y.extend(f.instanceConfig,D.config))}else if(D==="skip")return void u()}var g=f.instanceConfig.complete;f.instanceConfig.complete=function(W){b(g)&&g(W,f.file,f.inputElem),u()},i.parse(f.file,f.instanceConfig)}else b(a.complete)&&a.complete()}function u(){c.splice(0,1),d()}}}function _(a){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(o){var c=be(o);c.chunkSize=parseInt(c.chunkSize),o.step||o.chunk||(c.chunkSize=null),this._handle=new Z(c),(this._handle.streamer=this)._config=c}.call(this,a),this.parseChunk=function(o,c){if(this.isFirstChunk&&b(this._config.beforeFirstChunk)){var d=this._config.beforeFirstChunk(o);d!==void 0&&(o=d)}this.isFirstChunk=!1,this._halted=!1;var u=this._partialLine+o;this._partialLine="";var m=this._handle.parse(u,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var w=m.meta.cursor;this._finished||(this._partialLine=u.substring(w-this._baseIndex),this._baseIndex=w),m&&m.data&&(this._rowCount+=m.data.length);var N=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)r.postMessage({results:m,workerId:i.WORKER_ID,finished:N});else if(b(this._config.chunk)&&!c){if(this._config.chunk(m,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);m=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(m.data),this._completeResults.errors=this._completeResults.errors.concat(m.errors),this._completeResults.meta=m.meta),this._completed||!N||!b(this._config.complete)||m&&m.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),N||m&&m.meta.paused||this._nextChunk(),m}this._halted=!0},this._sendError=function(o){b(this._config.error)?this._config.error(o):n&&this._config.error&&r.postMessage({workerId:i.WORKER_ID,error:o,finished:!1})}}function M(a){var o;(a=a||{}).chunkSize||(a.chunkSize=i.RemoteChunkSize),_.call(this,a),this._nextChunk=t?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(c){this._input=c,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(o=new XMLHttpRequest,this._config.withCredentials&&(o.withCredentials=this._config.withCredentials),t||(o.onload=oe(this._chunkLoaded,this),o.onerror=oe(this._chunkError,this)),o.open(this._config.downloadRequestBody?"POST":"GET",this._input,!t),this._config.downloadRequestHeaders){var c=this._config.downloadRequestHeaders;for(var d in c)o.setRequestHeader(d,c[d])}if(this._config.chunkSize){var u=this._start+this._config.chunkSize-1;o.setRequestHeader("Range","bytes="+this._start+"-"+u)}try{o.send(this._config.downloadRequestBody)}catch(m){this._chunkError(m.message)}t&&o.status===0&&this._chunkError()}},this._chunkLoaded=function(){o.readyState===4&&(o.status<200||400<=o.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:o.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(c){var d=c.getResponseHeader("Content-Range");return d===null?-1:parseInt(d.substring(d.lastIndexOf("/")+1))}(o),this.parseChunk(o.responseText)))},this._chunkError=function(c){var d=o.statusText||c;this._sendError(new Error(d))}}function Q(a){var o,c;(a=a||{}).chunkSize||(a.chunkSize=i.LocalChunkSize),_.call(this,a);var d=typeof FileReader<"u";this.stream=function(u){this._input=u,c=u.slice||u.webkitSlice||u.mozSlice,d?((o=new FileReader).onload=oe(this._chunkLoaded,this),o.onerror=oe(this._chunkError,this)):o=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var u=this._input;if(this._config.chunkSize){var m=Math.min(this._start+this._config.chunkSize,this._input.size);u=c.call(u,this._start,m)}var w=o.readAsText(u,this._config.encoding);d||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(u){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(u.target.result)},this._chunkError=function(){this._sendError(o.error)}}function B(a){var o;_.call(this,a=a||{}),this.stream=function(c){return o=c,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var c,d=this._config.chunkSize;return d?(c=o.substring(0,d),o=o.substring(d)):(c=o,o=""),this._finished=!o,this.parseChunk(c)}}}function G(a){_.call(this,a=a||{});var o=[],c=!0,d=!1;this.pause=function(){_.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){_.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(u){this._input=u,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){d&&o.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),o.length?this.parseChunk(o.shift()):c=!0},this._streamData=oe(function(u){try{o.push(typeof u=="string"?u:u.toString(this._config.encoding)),c&&(c=!1,this._checkIsFinished(),this.parseChunk(o.shift()))}catch(m){this._streamError(m)}},this),this._streamError=oe(function(u){this._streamCleanUp(),this._sendError(u)},this),this._streamEnd=oe(function(){this._streamCleanUp(),d=!0,this._streamData("")},this),this._streamCleanUp=oe(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Z(a){var o,c,d,u=Math.pow(2,53),m=-u,w=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,N=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,I=this,f=0,D=0,g=!1,W=!1,U=[],p={data:[],errors:[],meta:{}};if(b(a.step)){var E=a.step;a.step=function(h){if(p=h,L())R();else{if(R(),p.data.length===0)return;f+=h.data.length,a.preview&&f>a.preview?c.abort():(p.data=p.data[0],E(p,I))}}}function J(h){return a.skipEmptyLines==="greedy"?h.join("").trim()==="":h.length===1&&h[0].length===0}function R(){return p&&d&&(F("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),d=!1),a.skipEmptyLines&&(p.data=p.data.filter(function(h){return!J(h)})),L()&&function(){if(!p)return;function h(S,j){b(a.transformHeader)&&(S=a.transformHeader(S,j)),U.push(S)}if(Array.isArray(p.data[0])){for(var k=0;L()&&k<p.data.length;k++)p.data[k].forEach(h);p.data.splice(0,1)}else p.data.forEach(h)}(),function(){if(!p||!a.header&&!a.dynamicTyping&&!a.transform)return p;function h(S,j){var T,H=a.header?{}:[];for(T=0;T<S.length;T++){var x=T,C=S[T];a.header&&(x=T>=U.length?"__parsed_extra":U[T]),a.transform&&(C=a.transform(C,x)),C=K(x,C),x==="__parsed_extra"?(H[x]=H[x]||[],H[x].push(C)):H[x]=C}return a.header&&(T>U.length?F("FieldMismatch","TooManyFields","Too many fields: expected "+U.length+" fields but parsed "+T,D+j):T<U.length&&F("FieldMismatch","TooFewFields","Too few fields: expected "+U.length+" fields but parsed "+T,D+j)),H}var k=1;return!p.data.length||Array.isArray(p.data[0])?(p.data=p.data.map(h),k=p.data.length):p.data=h(p.data,0),a.header&&p.meta&&(p.meta.fields=U),D+=k,p}()}function L(){return a.header&&U.length===0}function K(h,k){return S=h,a.dynamicTypingFunction&&a.dynamicTyping[S]===void 0&&(a.dynamicTyping[S]=a.dynamicTypingFunction(S)),(a.dynamicTyping[S]||a.dynamicTyping)===!0?k==="true"||k==="TRUE"||k!=="false"&&k!=="FALSE"&&(function(j){if(w.test(j)){var T=parseFloat(j);if(m<T&&T<u)return!0}return!1}(k)?parseFloat(k):N.test(k)?new Date(k):k===""?null:k):k;var S}function F(h,k,S,j){var T={type:h,code:k,message:S};j!==void 0&&(T.row=j),p.errors.push(T)}this.parse=function(h,k,S){var j=a.quoteChar||'"';if(a.newline||(a.newline=function(x,C){x=x.substring(0,1048576);var X=new RegExp(ee(C)+"([^]*?)"+ee(C),"gm"),V=(x=x.replace(X,"")).split("\r"),te=x.split(`
`),re=1<te.length&&te[0].length<V[0].length;if(V.length===1||re)return`
`;for(var q=0,A=0;A<V.length;A++)V[A][0]===`
`&&q++;return q>=V.length/2?`\r
`:"\r"}(h,j)),d=!1,a.delimiter)b(a.delimiter)&&(a.delimiter=a.delimiter(h),p.meta.delimiter=a.delimiter);else{var T=function(x,C,X,V,te){var re,q,A,O;te=te||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var le=0;le<te.length;le++){var v=te[le],fe=0,ne=0,de=0;A=void 0;for(var ae=new ye({comments:V,delimiter:v,newline:C,preview:10}).parse(x),se=0;se<ae.data.length;se++)if(X&&J(ae.data[se]))de++;else{var ie=ae.data[se].length;ne+=ie,A!==void 0?0<ie&&(fe+=Math.abs(ie-A),A=ie):A=ie}0<ae.data.length&&(ne/=ae.data.length-de),(q===void 0||fe<=q)&&(O===void 0||O<ne)&&1.99<ne&&(q=fe,re=v,O=ne)}return{successful:!!(a.delimiter=re),bestDelimiter:re}}(h,a.newline,a.skipEmptyLines,a.comments,a.delimitersToGuess);T.successful?a.delimiter=T.bestDelimiter:(d=!0,a.delimiter=i.DefaultDelimiter),p.meta.delimiter=a.delimiter}var H=be(a);return a.preview&&a.header&&H.preview++,o=h,c=new ye(H),p=c.parse(o,k,S),R(),g?{meta:{paused:!0}}:p||{meta:{paused:!1}}},this.paused=function(){return g},this.pause=function(){g=!0,c.abort(),o=b(a.chunk)?"":o.substring(c.getCharIndex())},this.resume=function(){I.streamer._halted?(g=!1,I.streamer.parseChunk(o,!0)):setTimeout(I.resume,3)},this.aborted=function(){return W},this.abort=function(){W=!0,c.abort(),p.meta.aborted=!0,b(a.complete)&&a.complete(p),o=""}}function ee(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ye(a){var o,c=(a=a||{}).delimiter,d=a.newline,u=a.comments,m=a.step,w=a.preview,N=a.fastMode,I=o=a.quoteChar===void 0||a.quoteChar===null?'"':a.quoteChar;if(a.escapeChar!==void 0&&(I=a.escapeChar),(typeof c!="string"||-1<i.BAD_DELIMITERS.indexOf(c))&&(c=","),u===c)throw new Error("Comment character same as delimiter");u===!0?u="#":(typeof u!="string"||-1<i.BAD_DELIMITERS.indexOf(u))&&(u=!1),d!==`
`&&d!=="\r"&&d!==`\r
`&&(d=`
`);var f=0,D=!1;this.parse=function(g,W,U){if(typeof g!="string")throw new Error("Input must be a string");var p=g.length,E=c.length,J=d.length,R=u.length,L=b(m),K=[],F=[],h=[],k=f=0;if(!g)return z();if(a.header&&!W){var S=g.split(d)[0].split(c),j=[],T={},H=!1;for(var x in S){var C=S[x];b(a.transformHeader)&&(C=a.transformHeader(C,x));var X=C,V=T[C]||0;for(0<V&&(H=!0,X=C+"_"+V),T[C]=V+1;j.includes(X);)X=X+"_"+V;j.push(X)}if(H){var te=g.split(d);te[0]=j.join(c),g=te.join(d)}}if(N||N!==!1&&g.indexOf(o)===-1){for(var re=g.split(d),q=0;q<re.length;q++){if(h=re[q],f+=h.length,q!==re.length-1)f+=d.length;else if(U)return z();if(!u||h.substring(0,R)!==u){if(L){if(K=[],de(h.split(c)),me(),D)return z()}else de(h.split(c));if(w&&w<=q)return K=K.slice(0,w),z(!0)}}return z()}for(var A=g.indexOf(c,f),O=g.indexOf(d,f),le=new RegExp(ee(I)+ee(o),"g"),v=g.indexOf(o,f);;)if(g[f]!==o)if(u&&h.length===0&&g.substring(f,f+R)===u){if(O===-1)return z();f=O+J,O=g.indexOf(d,f),A=g.indexOf(c,f)}else if(A!==-1&&(A<O||O===-1))h.push(g.substring(f,A)),f=A+E,A=g.indexOf(c,f);else{if(O===-1)break;if(h.push(g.substring(f,O)),ie(O+J),L&&(me(),D))return z();if(w&&K.length>=w)return z(!0)}else for(v=f,f++;;){if((v=g.indexOf(o,v+1))===-1)return U||F.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:f}),se();if(v===p-1)return se(g.substring(f,v).replace(le,o));if(o!==I||g[v+1]!==I){if(o===I||v===0||g[v-1]!==I){A!==-1&&A<v+1&&(A=g.indexOf(c,v+1)),O!==-1&&O<v+1&&(O=g.indexOf(d,v+1));var fe=ae(O===-1?A:Math.min(A,O));if(g.substr(v+1+fe,E)===c){h.push(g.substring(f,v).replace(le,o)),g[f=v+1+fe+E]!==o&&(v=g.indexOf(o,f)),A=g.indexOf(c,f),O=g.indexOf(d,f);break}var ne=ae(O);if(g.substring(v+1+ne,v+1+ne+J)===d){if(h.push(g.substring(f,v).replace(le,o)),ie(v+1+ne+J),A=g.indexOf(c,f),v=g.indexOf(o,f),L&&(me(),D))return z();if(w&&K.length>=w)return z(!0);break}F.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:f}),v++}}else v++}return se();function de(Y){K.push(Y),k=f}function ae(Y){var xe=0;if(Y!==-1){var Te=g.substring(v+1,Y);Te&&Te.trim()===""&&(xe=Te.length)}return xe}function se(Y){return U||(Y===void 0&&(Y=g.substring(f)),h.push(Y),f=p,de(h),L&&me()),z()}function ie(Y){f=Y,de(h),h=[],O=g.indexOf(d,f)}function z(Y){return{data:K,errors:F,meta:{delimiter:c,linebreak:d,aborted:D,truncated:!!Y,cursor:k+(W||0)}}}function me(){m(z()),K=[],F=[]}},this.abort=function(){D=!0},this.getCharIndex=function(){return f}}function ke(a){var o=a.data,c=s[o.workerId],d=!1;if(o.error)c.userError(o.error,o.file);else if(o.results&&o.results.data){var u={abort:function(){d=!0,ge(o.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ve,resume:ve};if(b(c.userStep)){for(var m=0;m<o.results.data.length&&(c.userStep({data:o.results.data[m],errors:o.results.errors,meta:o.results.meta},u),!d);m++);delete o.results}else b(c.userChunk)&&(c.userChunk(o.results,u,o.file),delete o.results)}o.finished&&!d&&ge(o.workerId,o.results)}function ge(a,o){var c=s[a];b(c.userComplete)&&c.userComplete(o),c.terminate(),delete s[a]}function ve(){throw new Error("Not implemented.")}function be(a){if(typeof a!="object"||a===null)return a;var o=Array.isArray(a)?[]:{};for(var c in a)o[c]=be(a[c]);return o}function oe(a,o){return function(){a.apply(o,arguments)}}function b(a){return typeof a=="function"}return n&&(r.onmessage=function(a){var o=a.data;if(i.WORKER_ID===void 0&&o&&(i.WORKER_ID=o.workerId),typeof o.input=="string")r.postMessage({workerId:i.WORKER_ID,results:i.parse(o.input,o.config),finished:!0});else if(r.File&&o.input instanceof File||o.input instanceof Object){var c=i.parse(o.input,o.config);c&&r.postMessage({workerId:i.WORKER_ID,results:c,finished:!0})}}),(M.prototype=Object.create(_.prototype)).constructor=M,(Q.prototype=Object.create(_.prototype)).constructor=Q,(B.prototype=Object.create(B.prototype)).constructor=B,(G.prototype=Object.create(_.prototype)).constructor=G,i})});function ht(e,r,t,n){return{scene:e,view:r,recordId:t,body:n}}function yt(e,r,t,n){return{scene:e,view:r,records:t}}function gt(e,r,t){return{scene:e,view:r,body:t}}function mt(e,r,t){return{scene:e,view:r,records:t}}function _t(e,r,t){return{scene:e,view:r,recordId:t}}function wt(e,r,t,n,s){if(n){var l=`https://api.knack.com/v1/pages/${e}/views/${r}/records?${n.name}_id=${n.id}`;return t&&(l+="&filters="+encodeURIComponent(JSON.stringify(t))),l}else{s||(s="both");let i={scene:e,view:r,format:s};return t&&(i.filters=t),i}}function kt(e,r,t){return{recordId:t.id,scene:e,view:r}}var Me={getSingle:(e,r,t)=>_t(e,r,t),getMany:(e,r,t,n,s)=>wt(e,r,t,n,s),postSingle:(e,r,t)=>gt(e,r,t),postMany:(e,r,t)=>mt(e,r,t),deleteSingle:(e,r,t)=>kt(e,r,t),putSingle:(e,r,t,n)=>ht(e,r,t,n),putMany:(e,r,t,n)=>yt(e,r,t,n)};function vt(e){return{match:e,rules:[]}}function bt(e){return{isDuringTheCurrentMonth:{field:e,operator:"is during the current",type:"month"},isDuringThePreviousMonth:{field:e,operator:"is during the previous",range:"1",type:"months"},isDuringTheNextMonth:{field:e,operator:"is during the next",range:"1",type:"months"},isBeforeThePreviousMonth:{field:e,operator:"is before the previous",range:"1",type:"months"}}}var $e={create:e=>vt(e),common:e=>bt(e)};var It=Ce(Se(),1);var we=Ce(Se(),1);async function ce(){let e="browser";if(e==="browser")return new we.default({auth:"view-based",applicationId:Knack.application_id,userToken:Knack.getUserToken()});if(e==="server"){let r=await At();return new we.default({auth:"view-based",applicationId:process.env.KNACK_APP_ID,userToken:r})}}async function At(){let e=new we.default({auth:"view-based",applicationId:process.env.KNACK_APP_ID});try{return await e.login({email:process.env.KNACK_API_LOGIN,password:process.env.KNACK_API_PASSWORD})}catch(r){console.log(r)}}async function Rt(e){let r=await ce();console.log("api call started");try{let t=await r.get(e);return console.log("api call completed"),t.json}catch(t){return console.log("api call failed",t),null}}async function Dt(e){let r=await ce();console.log("api call started");try{let t=await r.getMany(e);return console.log("api call completed"),t.records}catch(t){return console.log("api call failed",t),null}}async function xt(e){let r=e;var t=1,n=`&page=${t}&rows_per_page=1000`,s=r+n,l={Authorization:Knack.getUserToken(),"X-Knack-REST-API-Key":"knack","X-Knack-Application-Id":Knack.application_id,"Content-Type":"application/json"},i={},y=await Ue(s,l);if(i={...y},y.total_records>1e3){let M=y.total_pages;for(var _=2;_<=M;_++){var t=_,n=`&page=${t}&rows_per_page=1000`,s=r+n;y=await Ue(s,l),i.records=[...i.records,...y.records]}}return i}async function Pt(e){let r=await ce();console.log("api call started");try{let t=await r.postMany(e);return t.summary.rejected>0&&t.summary.errors.forEach(n=>{console.log(JSON.stringify(n.reason))}),console.log("api call completed"),t}catch(t){return console.log("api call failed",t),null}}async function Ot(e){let r=await ce();console.log("api call started");try{let n=(await r.post(e)).json;return console.log("api call completed"),n}catch(t){return console.log("api call failed",t),null}}async function Mt(e){let r=await ce();console.log("api call started");try{let n=await(await r.put(e)).json;return console.log("api call completed"),n}catch(t){return console.log("api call failed",t),null}}async function $t(e){let r=await ce();console.log("api call started");try{let t=await r.putMany(e);return t.summary.rejected>0&&res.summary.errors.forEach(n=>{errorHandler(n.reason)}),console.log("api call completed"),t}catch(t){return console.log("api call failed",t),null}}async function jt(e){let r=await ce();console.log("api call started");try{let t=await r.delete(e);return console.log("api call completed"),t}catch(t){return console.log("api call failed",t),null}}async function Ue(e,r){console.log("api call started");try{let n=await(await fetch(e,{method:"GET",headers:r})).json();return console.log("api call completed"),n}catch(t){return console.log("api call failed"),console.log("err",t),t}}var Je={getSingle:e=>Rt(e),getMany:e=>Dt(e),getManyParentRecord:e=>xt(e),postSingle:e=>Ot(e),postMany:e=>Pt(e),putMany:e=>$t(e),putSingle:e=>Mt(e),deleteSingle:e=>jt(e)};var He={isoTo_MMDDYYYY:e=>Kt(e),isoTo_DDMMYYYY:e=>Ft(e)};function Kt(e){return e=new Date(e),{date:e.toLocaleDateString("en-US"),hours:(e.getUTCHours()%12||12).toString().padStart(2,"0"),minutes:e.getUTCMinutes().toString().padStart(2,"0"),am_pm:e.getUTCHours()>=12?"PM":"AM"}}function Ft(e){return e=new Date(e),{date:e.toLocaleDateString("en-GB"),hours:(e.getUTCHours()%12||12).toString().padStart(2,"0"),minutes:e.getUTCMinutes().toString().padStart(2,"0"),am_pm:e.getUTCHours()>=12?"PM":"AM"}}var P={filters:$e,payloads:Me,calls:Je,utils:He};function Nt(e){$("#"+e+" .popup-message").remove()}function Lt(e,r,t){var n=$("#"+e),s=$("<div>").addClass("popup-message"),l=$("<div>").html(r).css({marginBottom:"20px",fontSize:"18px",color:"#fff"}),i=$("<div>").addClass("progress-bar-container"),y=$("<div>").attr("id","popup-progress-bar-"+e).addClass("popup-progress-bar"),_=$("<div>").attr("id","progress-text-"+e).addClass("progress-text").text("0%");i.append(y),i.append(_),s.append(l),t==="progress"&&(s.append(i),console.log("progress popup"));var M=$("<div>").addClass("spinner-container"),Q=$("<i>").addClass("fa fa-spinner fa-spin spinner").attr("id","popup-spinner-"+e);M.append(Q),t==="spinner"&&(s.append(M),console.log("spinner popup")),console.log(s.html()),n.css("position","relative").append(s)}function Ut(e,r){$("#popup-progress-bar-"+e).css("width",r+"%"),$("#progress-text-"+e).text(Math.round(r)+"%")}var Be={add:(e,r,t)=>Lt(e,r,t),remove:e=>Nt(e),update:(e,r)=>Ut(e,r)};var Ve={popup:Be};function qe(e){$("#"+e.key+" .kn-table thead tr").prepend('<th><input type="checkbox"></th>'),$("#"+e.key+" .kn-table tbody tr").each(function(){$(this).hasClass("kn-table-group")?$(this).prepend("<td></td>"):$(this).prepend('<td><input type="checkbox"></td>')})}function ze(e,r){r=r||(()=>!0),$("#"+e.key+' .kn-table thead input[type="checkbox"]').change(function(){var t=$(this).prop("checked");$("#"+e.key+' .kn-table tbody tr:not(.kn-table-group) input[type="checkbox"]').each(function(){var n=r();$(this).prop("checked",t&&n)})})}function Ye(e){let r=[];return $("#"+e.key+' .kn-table tbody tr:not(.kn-table-group) input[type="checkbox"]').each(function(){var t=$(this).prop("checked");if(t){var n=$(this).closest("tr").attr("id");r.push({id:n})}}),r}function Ge(e,r){let t=Knack.views[e.key].getFilters(),n;t.match?(t.rules.push(r),n=JSON.parse(JSON.stringify(t))):t.length?(t.push(r),n={match:"and",rules:JSON.parse(JSON.stringify(t))}):n=[r],Knack.views[e.key].handleChangeFilters(JSON.stringify(n))}function We(e,r){Knack.views[e.key].handleChangeFilters(JSON.stringify(r))}function Xe(e){var r=JSON.stringify(Knack.views[e.key].getFilters());Knack.views[e.key].handleChangeFilters(r)}var Qe={addCheckboxes:e=>qe(e),addHeadEventHandler:(e,r)=>ze(e,r),getChechedRecords:e=>Ye(e),addFilters:(e,r)=>Ge(e,r),setFilters:(e,r)=>We(e,r),reRender:e=>Xe(e)};var Ze={msg:Ve,views:{tables:Qe}};var tt=Ce(et(),1);function Jt(e,r){return tt.default.parse(e,{header:!0,skipEmptyLines:!0,dynamicTyping:r}).data}async function Ht(e){try{let r=await fetch(e);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return(await r.text()).trim()}catch(r){console.error("Error fetching the CSV file:",r)}}function Bt(e){return e.map(t=>{let n={};for(let[s,l]of Object.entries(t))try{let i=s.replace(/\r/g,"").trim(),y=l.replace(/\r/g,"").trim();n[i]=y}catch{n[s]=l}return n})}function Vt(e){let r=JSON.parse(e);return`<pre>${JSON.stringify(r,null,2)}</pre>`}var rt={parseCSV:(e,r)=>Jt(e,r),fetchCSV:e=>Ht(e),cleanCSV:e=>Bt(e),jsonToHtml:e=>Vt(e)};function qt(e){let r=new Date(e),t=String(r.getDate()).padStart(2,"0"),n=String(r.getMonth()+1).padStart(2,"0"),s=r.getFullYear(),l=r.getHours(),i=String(r.getMinutes()).padStart(2,"0"),y=l>=12?"PM":"AM";l=l%12||12;let _=`${t}/${n}/${s}`,M=`${String(l).padStart(2,"0")}:${i} ${y}`;return{date:_,time:M,string:_+" "+M}}function zt(e){let r=new Date(e);return r.setDate(r.getDate()-1),r.setHours(23,59,0,0),r.toISOString()}var nt={convert:{isoDateToDDMMYYYYHHMMampm:e=>qt(e)},operations:{ISO:{getPreviousDay1159pm:e=>zt(e)}}};var ot={files:rt,times:nt};async function Yt(e,r){try{let n=await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).text();return console.log("Success:",n),n}catch(t){console.error("Error:",t)}}async function Gt(e){try{let r=await $.ajax({url:e,method:"GET"});console.log("Success:",r)}catch(r){console.error("Error:",r)}}var Re={GET:e=>Gt(e),POST:(e,r)=>Yt(e,r)};$(document).on("knack-form-submit.view_44",async function(e,r,t){e.preventDefault();let n="http://localhost:3000/api/accounting/add-wise-transactions",s={test:"test"},l=await Re.POST(n,s);console.log(l)});$(document).on("knack-form-submit.view_42",async function(e,r,t){let n="http://localhost:3000/api/accounting/add-westpac-transactions",s={test:"test"},l=await Re.POST(n,s);console.log(l)});var at=-1;$(document).on("knack-view-render.view_45",async function(e,r,t){if(at+=1,at%2===0){knackInterface.msg.popup.add(r.key,"loading in progress","spinner");let s=knackApi.payloads.getMany("scene_26","view_45"),l=await knackApi.calls.getMany(s);console.log("records",l);let i=Wt(l);console.log("dupRecords",i);let y=knackApi.filters.create("OR");for(var n of i){let _={field:"field_177",operator:"is",value:n.field_177_raw};y.rules.push(_)}console.log("filters",y),knackInterface.views.tables.setFilters(r,y),knackInterface.msg.popup.remove(r.key)}knackInterface.views.tables.addCheckboxes(r),knackInterface.views.tables.addHeadEventHandler(r),$("#view_45_filters").remove()});function Wt(e){let r=e.reduce((n,s)=>{let l=s.field_177_raw;return n[l]=(n[l]||0)+1,n},{});return e.filter(n=>r[n.field_177_raw]>=2)}var De=[{bank:"WESTPAC",type:"",party:["Other Party"],details:["Particulars","Analysis (Code)","Reference"]},{bank:"WISE",type:"TRANSFER",party:["details.recipient.name"],details:["details.description","details.paymentReference"]},{bank:"WISE",type:"MONEY_ADDED",party:["exchangeDetails.fromAmount.currency","exchangeDetails.toAmount.currency"],details:["details.description","exchangeDetails.fromAmount.currency","exchangeDetails.fromAmount.value","exchangeDetails.toAmount.currency","exchangeDetails.toAmount.value"]},{bank:"WISE",type:"DEPOSIT",party:["details.senderName"],details:["details.description","details.senderAccount","details.paymentReference"]},{bank:"WISE",type:"CARD",party:["details.merchant.name"],details:["details.description","details.category"]},{bank:"WISE",type:"CONVERSION",party:["details.description"],details:["details.description","details.sourceAmount.value","details.sourceAmount.currency","details.targetAmount.value","details.targetAmount.currency","details.rate"]},{bank:"WISE",type:"ACCRUAL_CHARGE",party:["details.description"],details:["details.description","amount.value","amount.currency"]}];$(document).on("knack-view-render.view_55",async function(e,r,t){let n=P.payloads.getMany("scene_31","view_53"),s=await P.calls.getMany(n);console.log("tr_types",s);let l=P.payloads.getMany("scene_31","view_52"),i=await P.calls.getMany(l),y=Xt(i),_=Qt(s,y);if(_.length>0){let ke=Zt(_),ge=P.payloads.postMany("scene_31","view_54",ke),ve=await P.calls.postMany(ge)}let M=P.filters.create("AND"),Q={field:"field_233",operator:"is blank"};M.rules.push(Q);let B=P.payloads.getMany("scene_31","view_53",M),G=await P.calls.getMany(B);console.log("to_config_tr_types",G);let Z=er(G);console.log("config_tr_types",Z);let ee=P.payloads.putMany("scene_31","view_53",Z),ye=await P.calls.putMany(ee)});function Xt(e){return e.reduce((t,n)=>{let s=n.field_176_raw,l=n.field_229_raw[0]?.id;return t.some(i=>i.field_231_raw===s&&i.field_232_raw[0]?.id===l)||t.push({field_231_raw:s,field_232_raw:[{id:l}]}),t},[])}function Qt(e,r){return r.filter(n=>!e.some(s=>n.field_232_raw[0]?.id===s.field_232_raw[0]?.id&&n.field_231_raw===s.field_231_raw))}function Zt(e){return e.map(t=>({field_231:t.field_231_raw,field_232:t.field_232_raw[0]?.id}))}function er(e){let r=[];for(let t of e){let n=t.field_232_raw[0]?.identifier,s=t.field_231_raw,l=De.find(i=>i.bank===n.toUpperCase()&&i.type===s);if(console.log("mapping",l),l)r.push({id:t.id,field_233:JSON.stringify({party:l.party,details:l.details})});else{let i=De.find(y=>y.bank===n.toUpperCase()&&y.type==="");i?r.push({id:t.id,field_233:JSON.stringify({party:i.party,details:i.details})}):console.warn(`No mapping found for bank: ${n}, type: ${s}`)}}return r}$(document).on("knack-view-render.view_45",function(e,r,t){st(r,"field_228")});$(document).on("knack-view-render.view_46",function(e,r,t){st(r,"field_158")});function st(e,r){$(`#${e.key} td[data-field-key=${r}]`).each(function(){let t=$(this).find("span").text(),n=bimscJs.files.jsonToHtml(t);$(this).html(n)})}$(document).on("knack-view-render.view_38",async function(e,r,t){let n=P.payloads.getMany("scene_30","view_50"),s=await P.calls.getMany(n),l=P.payloads.getMany("scene_31","view_53"),i=await P.calls.getMany(l),y=[];if(s.length>0)for(let B of s){let G=i.find(Z=>B.field_229_raw[0].identifier===Z.field_232_raw[0].identifier&&B.field_176_raw===Z.field_231_raw);if(console.log("tr_type",G),G){let Z=JSON.parse(G.field_233_raw),ee=tr(JSON.parse(B.field_228),Z);ee.id=B.id,y.push(ee)}else console.warn("Transaction type not found for:",B)}let _=rr(y);console.log("pck_pro_trs",_);let M=P.payloads.putMany("scene_30","view_57",_),Q=await P.calls.putMany(M);console.log(Q)});function it(e,r){return r.split(".").reduce((t,n)=>t&&t[n],e)}function tr(e,r){let t=r.party.map(s=>it(e,s)).filter(Boolean).join(" to "),n=r.details.map(s=>it(e,s)).filter(Boolean).join(" ");return{party:t,details:n}}function rr(e){return e.map(r=>({id:r.id,field_235:r.party,field_236:r.details}))}window.knackApi=P;window.knackInterface=Ze;window.bimscJs=ot;
/*! Bundled license information:

papaparse/papaparse.min.js:
  (* @license
  Papa Parse
  v5.4.1
  https://github.com/mholt/PapaParse
  License: MIT
  *)
*/
